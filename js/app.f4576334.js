(function(){"use strict";var e={94:function(e,t,s){var n=s(5130),a=(s(4114),s(8111),s(2489),s(1701),s(3110),s(8335),s(6768)),u=s(144),o=s(4232);s(7588);const l={};function r(e,t){e in l||(l[e]={});const s=Object.keys(l[e]).length-1;return l[e][s]=t,s}function i(e,...t){e in l&&Object.values(l[e]).forEach(e=>{e(...t)})}let c={userGraph:{},userSize:{},userMemory:{},messages:[],userCount:0,time:0};function d(e){i("resetProgress"),c=e;for(let t=0;t<c.userCount;t++)i("createdUser",t);c.messages.forEach(e=>{i("addedMessage",e)})}function v(e,t){if(e>t)return v(t,e);const s=e.toString(32)+"_"+t.toString(32);return s in c.userGraph?c.userGraph[s]:0}function f(e,t,s){if(e>t)return void f(t,e,s);const n=e.toString(32)+"_"+t.toString(32);c.userGraph[n]=s}function p(e,t,s){let n=t,a=e;return 0!=e&&0!=s&&(n=1/e/s),0!=t&&0!=s&&(a=1/t/s),{newPx:n,newPo:a}}function g(e,t,s){const n=s-v(e,t);return f(e,t,s),n}function m(e){for(const t in e){const s=parseInt(t),n={};for(const a in e[t]){const e=c.messages[a],{dpx:t,dpo:u}=h(e,s);n[e.i]=u,n[e.j]=t}for(const e in n){if(e==t)continue;const a=n[e];Math.abs(a)>=.5&&y(s,parseInt(e),a)}}}function y(e,t,s){const n={id:c.messages.length,i:e,j:t,v:s,t:c.time};c.messages.push(n),i("addedMessage",n)}function h(e,t){t in c.userMemory||(c.userMemory[t]=[]),c.userMemory[t].push(e.id),console.log(c.userMemory);const{newPx:s,newPo:n}=p(v(t,e.i),v(t,e.j),e.v);return{dpx:g(t,e.j,s),dpo:g(t,e.i,n)}}function b(e,t){const s=(e,t)=>Math.abs(v(e,t))<.5;let n=s(e,t);if(!n){let a=!1;for(let n=1;n<t-e&&!a;n++)a=!s(e,e+n)&&!s(e+n,t);let u=!1;for(let n=1;n<e-t+c.userCount&&!u;n++){let a=t+n;a>=c.userCount&&(a-=c.userCount),u=!s(a,e)&&!s(t,a)}n=a&&u}return n}function k(){const e=c.userCount;c.userCount+=1,i("createdUser",e)}var M=s(2388),x=s(6051);const w=new x.Ay({apiKey:"sk-uFDUPAriuBg6l84rhrFxcRect2V0gpH59KVXj8dxG6wblr5p",baseURL:"http://localhost:8080/llmapi",dangerouslyAllowBrowser:!0});function R(e){return new Promise(t=>{setTimeout(t,e)})}async function _(e){for(let s=1;s<=2;s++)try{const t=await w.chat.completions.create({model:"kimi-k2-turbo-preview",messages:[{role:"system",content:e}],temperature:.6});return t.choices[0].message.content??""}catch(t){await R(5e3),console.error(t)}return""}let U={userTexts:[],messageTexts:[]};const T=localStorage.getItem("text");function C(e){return e>=0&&e<U.userTexts.length?U.userTexts[e]:{name:"",prompt:""}}function S(e){return e<0||e>=U.userTexts.length?e.toString():U.userTexts[e].name}function A(e){let t="";return e in c.userMemory&&c.userMemory[e].length>0&&(t=`你需要参考的信息：[${c.userMemory[e].filter(e=>e<U.messageTexts.length).map(e=>U.messageTexts[e].minimumVersion).join()}]。`),`${t}`}null!=T&&(U=JSON.parse(T));const F=["神经质","幽默","严肃"];function I(e){return e[Math.floor(Math.random()*F.length)]}function P(e,t){return e>.5?`对${t}的认同`:e<.5?`反对${t}`:"对社交媒体平台推送机制的反感"}function j(e){return`扮演一名社交媒体用户虚构贴文。你的个性：${I(F)}。${A(e.i)}要求1：长度1句话。要求2：站在${C(e.i).prompt}的视角表达你${P(e.v,C(e.j).prompt)}。`}function O(e){return`[${e}]扮演作者，选择1个短语作为标题，不要出现任何标点符号。`}function E(e){return`[${e}]一句话总结这篇社媒博文。`}const K=[];let X=!1;async function $(){if(X||0==K.length)return;console.log("生成新消息"),X=!0;const e=K[0];U.messageTexts.length-1<e.id&&U.messageTexts.push({title:"",content:"",minimumVersion:""});const t=await _(j(e)),s=await _(O(t)),n=await _(E(t));U.messageTexts[e.id]={title:s,content:t,minimumVersion:n},localStorage.setItem("text",JSON.stringify(U)),i("generatedMessage",e.id,s,t),K.shift(),X=!1,console.log("消息生成完毕")}async function V(e){(e.id>=U.messageTexts.length||""==U.messageTexts[e.id].title)&&K.push(e)}var L=(0,a.pM)({__name:"CanvasUser",props:{id:{},x:{},y:{},selected:{type:Boolean},focused:{type:Boolean},px:{},py:{},ps:{},badgeDefault:{},badgeInfo:{}},setup(e){const t=e;function s(){i("userPressed",t.id)}return(t,n)=>((0,a.uX)(),(0,a.CE)("div",{class:"canvas-user",style:(0,o.Tr)({left:(e.px+e.x)*e.ps-20+"px",top:(e.py+e.y)*e.ps-20+"px",outline:(e.selected?"2px":"1px")+" solid "+(e.focused?"#ff0":"#000")}),onClick:s},[(0,a.bF)((0,u.R1)(M.A),{value:e.badgeDefault,offset:[10,-5]},{default:(0,a.k6)(()=>[(0,a.bF)((0,u.R1)(M.A),{value:e.badgeInfo,type:"info",offset:[10,30]},{default:(0,a.k6)(()=>[(0,a.Lk)("div",null,(0,o.v_)((0,u.R1)(S)(e.id)),1)]),_:1},8,["value"])]),_:1},8,["value"])],4))}}),W=s(1241);const G=(0,W.A)(L,[["__scopeId","data-v-83950c74"]]);var B=G;const z=150,J=1/60,N=100;var D=(0,a.pM)({__name:"GameCanvas",props:{appState:{}},setup(e){const t=(0,u.KR)({users:[],selectedUsers:[],focusedUser:-1}),s=e,n=(0,u.KR)(0),l=(0,u.KR)(0),i=(0,u.KR)(1);r("userPressed",e=>{if("user-edit"==s.appState.mode)return;let n=t.value.selectedUsers;n.includes(e)?t.value.focusedUser!=e?t.value.focusedUser=e:(t.value.selectedUsers=n.filter(t=>t!=e),t.value.focusedUser=-1):(t.value.focusedUser=e,n.push(e))});let d=!1,p=0,g=0,m=0,y=0;function h(e){4==e.buttons&&(n.value+=e.movementX/i.value,l.value+=e.movementY/i.value),m=e.clientX,y=e.clientY,d=1==e.buttons}function k(e){1==e.buttons&&(d=!0,p=e.clientX,g=e.clientY),w=e.buttons}let M,x,w=0;function R(e){1==w&&(t.value.selectedUsers=[],t.value.focusedUser=-1),d&&Math.abs(m-p)>10&&Math.abs(y-g)>10&&(t.value.selectedUsers=t.value.users.filter(s=>{const a=(s.x+n.value)*i.value,u=(s.y+l.value)*i.value;let o=!!e.shiftKey&&t.value.selectedUsers.includes(s.id);return(a>p&&a<m||a>m&&a<p)&&(u>g&&u<y||u>y&&u<g)&&(o=!0),o}).map(e=>e.id)),d=!1}function _(e,t,s){let a=i.value,u=e/a-n.value,o=t/a-l.value;i.value*=s;let r=i.value,c=e/r-n.value,d=t/r-l.value;n.value+=c-u,l.value+=d-o}function U(e){let t=.01*e.wheelDelta;t<0&&(t+=2),t<0||t>2||_(e.clientX,e.clientY,t)}const T=J*N;function C(e,t,s,n,a,u,o){const l=s-e,r=n-t,i=l*l+r*r,c=Math.sqrt(i),d=z*u,v=15*o;let f=v*(c-d)/i*T;return a&&c>=d&&(f=0),{x:l*f,y:r*f}}function S(){const e=t.value.users;for(let t=0;t<c.userCount-1;t++){const s=e[t];for(let n=t+1;n<c.userCount;n++){const a=e[n],u=b(t,n);let o=C(s.x,s.y,a.x,a.y,u,u?1:.5,.5);s.vx+=o.x,s.vy+=o.y,a.vx-=o.x,a.vy-=o.y}}Object.values(t.value.users).forEach(e=>{e.vx*=1-.2*T,e.vy*=1-.2*T,e.vx-=.01*e.x*T,e.vy-=.01*e.y*T,e.x+=e.vx*T,e.y+=e.vy*T}),A()}function A(){M.width=window.innerWidth,M.height=window.innerHeight,Object.entries(c.userGraph).forEach(([e,s])=>{const a=e.split("_"),u=parseInt(a[0],32),o=parseInt(a[1],32),r=t.value.users[u],c=t.value.users[o],d=v(u,o);let f=Math.abs(d);if(f<0)return;const p=`#${d<0?"ff":"00"}00${d>=0?"ff":"00"}${Math.floor(255*f).toString(16).padStart(2,"0")}`;x.strokeStyle=p,x.beginPath(),x.moveTo((r.x+n.value)*i.value,(r.y+l.value)*i.value),x.lineTo((c.x+n.value)*i.value,(c.y+l.value)*i.value),x.stroke()});const e=m-p,s=y-g;d&&Math.abs(e)>10&&Math.abs(s)>10&&(x.rect(p,g,e,s),x.fillStyle="#00000033",x.fill())}return(0,a.sV)(()=>{M=document.getElementById("lines"),x=M.getContext("2d"),setInterval(S,1e3*J),document.addEventListener("keydown",e=>{const s=t.value.focusedUser;"a"==e.key&&e.ctrlKey&&s>=0?t.value.selectedUsers.forEach(e=>{e!=s&&f(e,s,1)}):"c"==e.key&&e.ctrlKey&&s>=0?t.value.selectedUsers.forEach(e=>{e!=s&&f(e,s,0)}):"Escape"==e.key&&(t.value.selectedUsers=[],t.value.focusedUser=-1)}),r("createdUser",e=>{t.value.users.push({id:e,x:e%2*100,y:100*Math.floor(e/2),vx:0,vy:0})})}),(s,u)=>((0,a.uX)(),(0,a.CE)("div",{class:"canvas",style:(0,o.Tr)({"background-size":20*i.value+"px "+20*i.value+"px","background-position":n.value*i.value+"px "+l.value*i.value+"px"})},[(0,a.Lk)("div",{class:"mouse-input-handler",onMousedown:k,onMouseup:R,onMousemove:h,onWheel:U},null,32),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.value.users,s=>((0,a.uX)(),(0,a.Wv)(B,{key:s.id,id:s.id,x:s.x,y:s.y,px:n.value,py:l.value,ps:i.value,selected:t.value.selectedUsers.includes(s.id),focused:t.value.focusedUser==s.id,"badge-default":s.id in e.appState.uncollectedMessages?e.appState.uncollectedMessages[s.id].length:0,"badge-info":s.id in e.appState.readyToPushMessages?e.appState.readyToPushMessages[s.id].length:0},null,8,["id","x","y","px","py","ps","selected","focused","badge-default","badge-info"]))),128)),u[0]||(u[0]=(0,a.Lk)("canvas",{id:"lines"},null,-1))],4))}});const Y=(0,W.A)(D,[["__scopeId","data-v-f40eb24c"]]);var H=Y,q=s(2517),Q=s(2151);const Z={key:1},ee={key:1};var te=(0,a.pM)({__name:"MessageCard",props:{msg:{}},setup(e){const t=e;let s=(0,u.KR)(""),n=(0,u.KR)("");const l=setInterval(()=>{const e=U.messageTexts[t.msg.id];"undefined"!=typeof e&&""!=e.title&&(s.value=e.title,n.value=e.content,clearInterval(l))},100);return(t,l)=>((0,a.uX)(),(0,a.Wv)((0,u.R1)(q.Ay),{class:"message-card",hoverable:""},{header:(0,a.k6)(()=>[""==(0,u.R1)(s)?((0,a.uX)(),(0,a.Wv)((0,u.R1)(Q.A),{key:0,width:100,round:""})):((0,a.uX)(),(0,a.CE)("div",Z,[(0,a.Lk)("h3",null,(0,o.v_)((0,u.R1)(s)),1)]))]),action:(0,a.k6)(()=>[(0,a.RG)(t.$slots,"action")]),default:(0,a.k6)(()=>[""==(0,u.R1)(n)?((0,a.uX)(),(0,a.Wv)((0,u.R1)(Q.A),{key:0,text:"",repeat:2})):((0,a.uX)(),(0,a.CE)("div",ee,[(0,a.Lk)("p",null,(0,o.v_)(e.msg.t),1),(0,a.Lk)("p",null,(0,o.v_)((0,u.R1)(n)),1)]))]),_:3}))}});const se=(0,W.A)(te,[["__scopeId","data-v-3848783c"]]);var ne=se,ae=s(9203),ue=(0,a.pM)({__name:"MessageList",props:(0,a.zz)({source:{},select:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,s=(0,a.fn)(e,"modelValue");function n(){return[{title:"创作群体",key:"i"},{title:"时间",key:"t"},{title:"涉及群体",key:"j"},{title:"态度",key:"v"}]}let o=n();return t.select&&(o=[{type:"selection",multiple:!0},...o]),(t,n)=>((0,a.uX)(),(0,a.Wv)((0,u.R1)(ae.A),{"checked-row-keys":s.value,"onUpdate:checkedRowKeys":n[0]||(n[0]=e=>s.value=e),columns:(0,u.R1)(o),data:e.source,pagination:!1,bordered:!1,"row-key":e=>e.id,striped:""},null,8,["checked-row-keys","columns","data","row-key"]))}});const oe=ue;var le=oe,re=s(6693),ie=s(9310),ce=s(4526),de=s(7772),ve=s(496),fe=s(8122),pe=s(7732),ge=s(8140);const me={class:"app"},ye={class:"corner-buttons"};var he=(0,a.pM)({__name:"App",setup(e){(0,a.sV)(()=>{const e=localStorage.getItem("appstate");null!=e&&(t.value=JSON.parse(e));const s=localStorage.getItem("progress");if(null!=s)d(JSON.parse(s));else for(let t=0;t<10;t++){k();for(let e=0;e<t;e++){const s=Math.floor(3*Math.random())-1;f(t,e,s),Math.abs(s)>.5&&(Math.random()>.5?y(t,e,s):y(e,t,s))}}window.addEventListener("beforeunload",()=>{localStorage.setItem("appstate",JSON.stringify(t.value)),localStorage.setItem("progress",JSON.stringify(c))})});const t=(0,u.KR)({mode:"user-edit",editingUser:-1,uncollectedMessages:{},collectedMessages:[],readyToPushMessages:{}}),s=(0,u.KR)(!1),n=(0,u.KR)(!1),l=(0,u.KR)(c.messages);function i(e){return l.value.filter(t=>t.i==e)}function v(e){return t.value.collectedMessages.map(e=>c.messages[e]).filter(t=>t.i!=e&&(void 0==c.userMemory[e]||c.userMemory[e].includes(t.id)))}function p(e){t.value.uncollectedMessages[e.i]=t.value.uncollectedMessages[e.i].filter(t=>t!=e.id)}function g(e){p(e),t.value.collectedMessages.push(e.id)}function h(){c.time+=1,m(t.value.readyToPushMessages),t.value.readyToPushMessages={}}return r("userPressed",e=>{"user-edit"==t.value.mode&&(e in t.value.readyToPushMessages||(t.value.readyToPushMessages[e]=[]),s.value=!0,t.value.editingUser=e)}),r("addedMessage",e=>{e.i in t.value.uncollectedMessages||(t.value.uncollectedMessages[e.i]=[]),t.value.uncollectedMessages[e.i].push(e.id)}),r("addedMessage",e=>V(e)),setInterval(()=>{$()},1e3),(e,l)=>((0,a.uX)(),(0,a.CE)("div",me,[(0,a.bF)(H,{"app-state":t.value,ref:"canvas"},null,8,["app-state"]),(0,a.bF)((0,u.R1)(re.A),{show:s.value,"onUpdate:show":l[2]||(l[2]=e=>s.value=e),width:600},{default:(0,a.k6)(()=>[(0,a.bF)((0,u.R1)(ie.A),{"native-scrollbar":!1},{header:(0,a.k6)(()=>[(0,a.bF)((0,u.R1)(ce.A),{subtitle:"用户分析",onBack:l[0]||(l[0]=e=>{t.value.editingUser=-1,s.value=!1})}),(0,a.Lk)("h1",null,"#"+(0,o.v_)((0,u.R1)(S)(t.value.editingUser)),1)]),default:(0,a.k6)(()=>[(0,a.bF)((0,u.R1)(de.A),{class:"user-editor",type:"segment",animated:""},{default:(0,a.k6)(()=>[(0,a.bF)((0,u.R1)(ve.A),{name:"new",tab:"最新发言"},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.value.uncollectedMessages[t.value.editingUser],e=>((0,a.uX)(),(0,a.Wv)(ne,{msg:(0,u.R1)(c).messages[e],key:e},{action:(0,a.k6)(()=>[(0,a.bF)((0,u.R1)(fe.A),{justify:"space-between"},{default:(0,a.k6)(()=>[(0,a.bF)((0,u.R1)(pe.Ay),{onClick:t=>g((0,u.R1)(c).messages[e])},{default:(0,a.k6)(()=>[...l[5]||(l[5]=[(0,a.eW)("收集",-1)])]),_:1},8,["onClick"]),(0,a.bF)((0,u.R1)(pe.Ay),{onClick:t=>p((0,u.R1)(c).messages[e])},{default:(0,a.k6)(()=>[...l[6]||(l[6]=[(0,a.eW)("忽略",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["msg"]))),128))]),_:1}),(0,a.bF)((0,u.R1)(ve.A),{name:"history",tab:"历史发言"},{default:(0,a.k6)(()=>[(0,a.bF)(le,{source:i(t.value.editingUser),select:!1},null,8,["source"])]),_:1}),(0,a.bF)((0,u.R1)(ve.A),{name:"push-list",tab:"本次推送"},{default:(0,a.k6)(()=>[(0,a.bF)(le,{source:v(t.value.editingUser),select:!0,modelValue:t.value.readyToPushMessages[t.value.editingUser],"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.readyToPushMessages[t.value.editingUser]=e)},null,8,["source","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),(0,a.Lk)("div",ye,[(0,a.bF)((0,u.R1)(pe.Ay),{round:"",type:"primary",size:"large",onClick:l[3]||(l[3]=e=>n.value=!0)},{default:(0,a.k6)(()=>[...l[7]||(l[7]=[(0,a.eW)("已收集消息",-1)])]),_:1}),(0,a.bF)((0,u.R1)(pe.Ay),{round:"",type:"primary",size:"large",onClick:h},{default:(0,a.k6)(()=>[...l[8]||(l[8]=[(0,a.eW)("结束回合",-1)])]),_:1})]),(0,a.bF)((0,u.R1)(ge.A),{show:n.value,"onUpdate:show":l[4]||(l[4]=e=>n.value=e)},{default:(0,a.k6)(()=>[(0,a.bF)((0,u.R1)(q.Ay),{style:{width:"600px"},title:"已收集消息"},{default:(0,a.k6)(()=>[(0,a.bF)(le,{source:t.value.collectedMessages.map(e=>(0,u.R1)(c).messages[e]),select:!1},null,8,["source"])]),_:1})]),_:1},8,["show"])]))}});const be=he;var ke=be;(0,n.Ef)(ke).mount("#app")}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var u=t[n]={exports:{}};return e[n].call(u.exports,u,u.exports,s),u.exports}s.m=e,function(){var e=[];s.O=function(t,n,a,u){if(!n){var o=1/0;for(c=0;c<e.length;c++){n=e[c][0],a=e[c][1],u=e[c][2];for(var l=!0,r=0;r<n.length;r++)(!1&u||o>=u)&&Object.keys(s.O).every(function(e){return s.O[e](n[r])})?n.splice(r--,1):(l=!1,u<o&&(o=u));if(l){e.splice(c--,1);var i=a();void 0!==i&&(t=i)}}return t}u=u||0;for(var c=e.length;c>0&&e[c-1][2]>u;c--)e[c]=e[c-1];e[c]=[n,a,u]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,u,o=n[0],l=n[1],r=n[2],i=0;if(o.some(function(t){return 0!==e[t]})){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(r)var c=r(s)}for(t&&t(n);i<o.length;i++)u=o[i],s.o(e,u)&&e[u]&&e[u][0](),e[u]=0;return s.O(c)},n=self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[504],function(){return s(94)});n=s.O(n)})();
//# sourceMappingURL=app.f4576334.js.map