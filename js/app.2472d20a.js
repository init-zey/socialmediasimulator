(function(){"use strict";var e={9542:function(e,t,s){var n=s(5130),u=(s(4114),s(8111),s(2489),s(1701),s(3110),s(8335),s(6768)),a=s(144),o=s(4232);s(7588);const l={};function r(e,t){e in l||(l[e]={});const s=Object.keys(l[e]).length-1;return l[e][s]=t,s}function i(e,...t){e in l&&Object.values(l[e]).forEach(e=>{e(...t)})}let c={userGraph:{},userSize:{},userMemory:{},messages:[],userCount:0,time:0};function d(e){i("resetProgress"),c=e;for(let t=0;t<c.userCount;t++)i("createdUser",t);c.messages.forEach(e=>{i("addedMessage",e)})}function v(e,t){if(e>t)return v(t,e);const s=e.toString(32)+"_"+t.toString(32);return s in c.userGraph?c.userGraph[s]:0}function f(e,t,s){if(e>t)return void f(t,e,s);const n=e.toString(32)+"_"+t.toString(32);c.userGraph[n]=s}function p(e,t,s){let n=t,u=e;return 0!=e&&0!=s&&(n=1/e/s),0!=t&&0!=s&&(u=1/t/s),{newPx:n,newPo:u}}function g(e,t,s){const n=s-v(e,t);return f(e,t,s),n}function h(e){for(const t in e){const s=parseInt(t),n={};for(const u in e[t]){const e=c.messages[u],{dpx:t,dpo:a}=y(e,s);n[e.i]=a,n[e.j]=t}for(const e in n){if(e==t)continue;const u=n[e];Math.abs(u)>=.5&&m(s,parseInt(e),u)}}}function m(e,t,s){const n={id:c.messages.length,i:e,j:t,v:s,t:c.time};c.messages.push(n),i("addedMessage",n)}function y(e,t){t in c.userMemory||(c.userMemory[t]=[]),c.userMemory[t].push(e.id),console.log(c.userMemory);const{newPx:s,newPo:n}=p(v(t,e.i),v(t,e.j),e.v);return{dpx:g(t,e.j,s),dpo:g(t,e.i,n)}}function b(e,t){const s=(e,t)=>Math.abs(v(e,t))<.5;let n=s(e,t);if(!n){let u=!1;for(let n=1;n<t-e&&!u;n++)u=!s(e,e+n)&&!s(e+n,t);let a=!1;for(let n=1;n<e-t+c.userCount&&!a;n++){let u=t+n;u>=c.userCount&&(u-=c.userCount),a=!s(u,e)&&!s(t,u)}n=u&&a}return n}function k(){const e=c.userCount;c.userCount+=1,i("createdUser",e)}var M=s(2388),x=s(6051);new x.Ay({apiKey:"sk-uFDUPAriuBg6l84rhrFxcRect2V0gpH59KVXj8dxG6wblr5p",baseURL:"http://localhost:8080/llmapi",dangerouslyAllowBrowser:!0});function w(e){return new Promise(t=>{setTimeout(t,e)})}async function R(e){return await w(100),e}let _={userTexts:[],messageTexts:[]};const U=localStorage.getItem("text");function T(e){return e>=0&&e<_.userTexts.length?_.userTexts[e]:{name:"",prompt:""}}function C(e){return e<0||e>=_.userTexts.length?e.toString():_.userTexts[e].name}function S(e){let t="";return e in c.userMemory&&c.userMemory[e].length>0&&(t=`你需要参考的信息：[${c.userMemory[e].filter(e=>e<_.messageTexts.length).map(e=>_.messageTexts[e].minimumVersion).join()}]。`),`${t}`}null!=U&&(_=JSON.parse(U));const A=["神经质","幽默","严肃"];function F(e){return e[Math.floor(Math.random()*A.length)]}function I(e,t){return e>.5?`对${t}的认同`:e<.5?`反对${t}`:"对社交媒体平台推送机制的反感"}function P(e){return`扮演一名社交媒体用户虚构贴文。你的个性：${F(A)}。${S(e.i)}要求1：长度1句话。要求2：站在${T(e.i).prompt}的视角表达你${I(e.v,T(e.j).prompt)}。`}function X(e){return`[${e}]扮演作者，选择1个短语作为标题，不要出现任何标点符号。`}function j(e){return`[${e}]一句话总结这篇社媒博文。`}const O=[];let E=!1;async function K(){if(E||0==O.length)return;console.log("生成新消息"),E=!0;const e=O[0];_.messageTexts.length-1<e.id&&_.messageTexts.push({title:"",content:"",minimumVersion:""});const t=await R(P(e)),s=await R(X(t)),n=await R(j(t));_.messageTexts[e.id]={title:s,content:t,minimumVersion:n},localStorage.setItem("text",JSON.stringify(_)),i("generatedMessage",e.id,s,t),O.shift(),E=!1,console.log("消息生成完毕")}async function $(e){(e.id>=_.messageTexts.length||""==_.messageTexts[e.id].title)&&O.push(e)}var V=(0,u.pM)({__name:"CanvasUser",props:{id:{},x:{},y:{},selected:{type:Boolean},focused:{type:Boolean},px:{},py:{},ps:{},badgeDefault:{},badgeInfo:{}},setup(e){const t=e;function s(){i("userPressed",t.id)}return(t,n)=>((0,u.uX)(),(0,u.CE)("div",{class:"canvas-user",style:(0,o.Tr)({left:(e.px+e.x)*e.ps-20+"px",top:(e.py+e.y)*e.ps-20+"px",outline:(e.selected?"2px":"1px")+" solid "+(e.focused?"#ff0":"#000")}),onClick:s},[(0,u.bF)((0,a.R1)(M.A),{value:e.badgeDefault,offset:[10,-5]},{default:(0,u.k6)(()=>[(0,u.bF)((0,a.R1)(M.A),{value:e.badgeInfo,type:"info",offset:[10,30]},{default:(0,u.k6)(()=>[(0,u.Lk)("div",null,(0,o.v_)((0,a.R1)(C)(e.id)),1)]),_:1},8,["value"])]),_:1},8,["value"])],4))}}),W=s(1241);const L=(0,W.A)(V,[["__scopeId","data-v-83950c74"]]);var G=L;const Y=150,B=1/60,D=100;var z=(0,u.pM)({__name:"GameCanvas",props:{appState:{}},setup(e){const t=(0,a.KR)({users:[],selectedUsers:[],focusedUser:-1}),s=e,n=(0,a.KR)(0),l=(0,a.KR)(0),i=(0,a.KR)(1);r("userPressed",e=>{if("user-edit"==s.appState.mode)return;let n=t.value.selectedUsers;n.includes(e)?t.value.focusedUser!=e?t.value.focusedUser=e:(t.value.selectedUsers=n.filter(t=>t!=e),t.value.focusedUser=-1):(t.value.focusedUser=e,n.push(e))});let d=!1,p=0,g=0,h=0,m=0,y=0,k=0,M=0,x=0,w=-1;function R(e){if(e.preventDefault(),1==e.touches.length){const t=e.touches[0];y=t.clientX,k=t.clientY,M=n.value,x=l.value}}function _(e){e.preventDefault(),0==e.touches.length&&(w=-1)}function U(e){if(e.preventDefault(),1==e.touches.length&&-1==w){const t=e.touches[0];h=t.clientX,m=t.clientY,n.value=h-y+M,l.value=m-k+x}else if(2==e.touches.length){const t=e.touches[0].clientX,s=e.touches[0].clientY,n=e.touches[1].clientX,u=e.touches[1].clientY,a=Math.sqrt((t-n)*(t-n)+(s-u)*(s-u));if(w>0){let e=.01*(a-w);e<-1&&(e=-1),e>1&&(e=1),e+=1,P((t+n)/2,(s+u)/2,e)}w=a}}function T(e){4==e.buttons&&(n.value+=e.movementX/i.value,l.value+=e.movementY/i.value),h=e.clientX,m=e.clientY,d=1==e.buttons}function C(e){1==e.buttons&&(d=!0,p=e.clientX,g=e.clientY),F=e.buttons}let S,A,F=0;function I(e){1==F&&(t.value.selectedUsers=[],t.value.focusedUser=-1),d&&Math.abs(h-p)>10&&Math.abs(m-g)>10&&(t.value.selectedUsers=t.value.users.filter(s=>{const u=(s.x+n.value)*i.value,a=(s.y+l.value)*i.value;let o=!!e.shiftKey&&t.value.selectedUsers.includes(s.id);return(u>p&&u<h||u>h&&u<p)&&(a>g&&a<m||a>m&&a<g)&&(o=!0),o}).map(e=>e.id)),d=!1}function P(e,t,s){let u=i.value,a=e/u-n.value,o=t/u-l.value;i.value*=s;let r=i.value,c=e/r-n.value,d=t/r-l.value;n.value+=c-a,l.value+=d-o}function X(e){let t=.01*e.wheelDelta;t<0&&(t+=2),t<0||t>2||P(e.clientX,e.clientY,t)}const j=B*D;function O(e,t,s,n,u,a,o){const l=s-e,r=n-t,i=l*l+r*r,c=Math.sqrt(i),d=Y*a,v=15*o;let f=v*(c-d)/i*j;return u&&c>=d&&(f=0),{x:l*f,y:r*f}}function E(){const e=t.value.users;for(let t=0;t<c.userCount-1;t++){const s=e[t];for(let n=t+1;n<c.userCount;n++){const u=e[n],a=b(t,n);let o=O(s.x,s.y,u.x,u.y,a,a?1:.5,.5);s.vx+=o.x,s.vy+=o.y,u.vx-=o.x,u.vy-=o.y}}Object.values(t.value.users).forEach(e=>{e.vx*=1-.2*j,e.vy*=1-.2*j,e.vx-=.01*e.x*j,e.vy-=.01*e.y*j,e.x+=e.vx*j,e.y+=e.vy*j}),K()}function K(){S.width=window.innerWidth,S.height=window.innerHeight,Object.entries(c.userGraph).forEach(([e,s])=>{const u=e.split("_"),a=parseInt(u[0],32),o=parseInt(u[1],32),r=t.value.users[a],c=t.value.users[o],d=v(a,o);let f=Math.abs(d);if(f<0)return;const p=`#${d<0?"ff":"00"}00${d>=0?"ff":"00"}${Math.floor(255*f).toString(16).padStart(2,"0")}`;A.strokeStyle=p,A.beginPath(),A.moveTo((r.x+n.value)*i.value,(r.y+l.value)*i.value),A.lineTo((c.x+n.value)*i.value,(c.y+l.value)*i.value),A.stroke()});const e=h-p,s=m-g;d&&Math.abs(e)>10&&Math.abs(s)>10&&(A.rect(p,g,e,s),A.fillStyle="#00000033",A.fill())}return(0,u.sV)(()=>{S=document.getElementById("lines"),A=S.getContext("2d"),setInterval(E,1e3*B),document.addEventListener("keydown",e=>{const s=t.value.focusedUser;"a"==e.key&&e.ctrlKey&&s>=0?t.value.selectedUsers.forEach(e=>{e!=s&&f(e,s,1)}):"c"==e.key&&e.ctrlKey&&s>=0?t.value.selectedUsers.forEach(e=>{e!=s&&f(e,s,0)}):"Escape"==e.key&&(t.value.selectedUsers=[],t.value.focusedUser=-1)}),r("createdUser",e=>{t.value.users.push({id:e,x:e%2*100,y:100*Math.floor(e/2),vx:0,vy:0})})}),(s,a)=>((0,u.uX)(),(0,u.CE)("div",{class:"canvas",style:(0,o.Tr)({"background-size":20*i.value+"px "+20*i.value+"px","background-position":n.value*i.value+"px "+l.value*i.value+"px"})},[(0,u.Lk)("div",{class:"mouse-input-handler",onMousedown:C,onMouseup:I,onMousemove:T,onTouchstart:R,onTouchend:_,onTouchmove:U,onWheel:X},null,32),((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(t.value.users,s=>((0,u.uX)(),(0,u.Wv)(G,{key:s.id,id:s.id,x:s.x,y:s.y,px:n.value,py:l.value,ps:i.value,selected:t.value.selectedUsers.includes(s.id),focused:t.value.focusedUser==s.id,"badge-default":s.id in e.appState.uncollectedMessages?e.appState.uncollectedMessages[s.id].length:0,"badge-info":s.id in e.appState.readyToPushMessages?e.appState.readyToPushMessages[s.id].length:0},null,8,["id","x","y","px","py","ps","selected","focused","badge-default","badge-info"]))),128)),a[0]||(a[0]=(0,u.Lk)("canvas",{id:"lines"},null,-1))],4))}});const J=(0,W.A)(z,[["__scopeId","data-v-da511bb6"]]);var N=J,q=s(2517),H=s(2151);const Q={key:1},Z={key:1};var ee=(0,u.pM)({__name:"MessageCard",props:{msg:{}},setup(e){const t=e;let s=(0,a.KR)(""),n=(0,a.KR)("");const l=setInterval(()=>{const e=_.messageTexts[t.msg.id];"undefined"!=typeof e&&""!=e.title&&(s.value=e.title,n.value=e.content,clearInterval(l))},100);return(t,l)=>((0,u.uX)(),(0,u.Wv)((0,a.R1)(q.Ay),{class:"message-card",hoverable:""},{header:(0,u.k6)(()=>[""==(0,a.R1)(s)?((0,u.uX)(),(0,u.Wv)((0,a.R1)(H.A),{key:0,width:100,round:""})):((0,u.uX)(),(0,u.CE)("div",Q,[(0,u.Lk)("h3",null,(0,o.v_)((0,a.R1)(s)),1)]))]),action:(0,u.k6)(()=>[(0,u.RG)(t.$slots,"action")]),default:(0,u.k6)(()=>[""==(0,a.R1)(n)?((0,u.uX)(),(0,u.Wv)((0,a.R1)(H.A),{key:0,text:"",repeat:2})):((0,u.uX)(),(0,u.CE)("div",Z,[(0,u.Lk)("p",null,(0,o.v_)(e.msg.t),1),(0,u.Lk)("p",null,(0,o.v_)((0,a.R1)(n)),1)]))]),_:3}))}});const te=(0,W.A)(ee,[["__scopeId","data-v-3848783c"]]);var se=te,ne=s(9203),ue=(0,u.pM)({__name:"MessageList",props:(0,u.zz)({source:{},select:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,s=(0,u.fn)(e,"modelValue");function n(){return[{title:"创作群体",key:"i"},{title:"时间",key:"t"},{title:"涉及群体",key:"j"},{title:"态度",key:"v"}]}let o=n();return t.select&&(o=[{type:"selection",multiple:!0},...o]),(t,n)=>((0,u.uX)(),(0,u.Wv)((0,a.R1)(ne.A),{"checked-row-keys":s.value,"onUpdate:checkedRowKeys":n[0]||(n[0]=e=>s.value=e),columns:(0,a.R1)(o),data:e.source,pagination:!1,bordered:!1,"row-key":e=>e.id,striped:""},null,8,["checked-row-keys","columns","data","row-key"]))}});const ae=ue;var oe=ae,le=s(6693),re=s(9310),ie=s(4526),ce=s(7772),de=s(496),ve=s(8122),fe=s(7732),pe=s(8140);const ge={class:"app"},he={class:"corner-buttons"};var me=(0,u.pM)({__name:"App",setup(e){(0,u.sV)(()=>{const e=localStorage.getItem("progress");null!=e&&d(JSON.parse(e));const s=localStorage.getItem("appstate");if(null!=s)t.value=JSON.parse(s);else for(let t=0;t<10;t++){k();for(let e=0;e<t;e++){const s=Math.floor(3*Math.random())-1;f(t,e,s),Math.abs(s)>.5&&(Math.random()>.5?m(t,e,s):m(e,t,s))}}window.addEventListener("beforeunload",()=>{localStorage.setItem("appstate",JSON.stringify(t.value)),localStorage.setItem("progress",JSON.stringify(c))})});const t=(0,a.KR)({mode:"user-edit",editingUser:-1,uncollectedMessages:{},collectedMessages:[],readyToPushMessages:{}}),s=(0,a.KR)(!1),n=(0,a.KR)(!1),l=(0,a.KR)(c.messages);function i(e){return l.value.filter(t=>t.i==e)}function v(e){return t.value.collectedMessages.map(e=>c.messages[e]).filter(t=>t.i!=e&&(void 0==c.userMemory[e]||c.userMemory[e].includes(t.id)))}function p(e){t.value.uncollectedMessages[e.i]=t.value.uncollectedMessages[e.i].filter(t=>t!=e.id)}function g(e){p(e),t.value.collectedMessages.push(e.id)}function y(){c.time+=1,h(t.value.readyToPushMessages),t.value.readyToPushMessages={}}r("userPressed",e=>{"user-edit"==t.value.mode&&(e in t.value.readyToPushMessages||(t.value.readyToPushMessages[e]=[]),s.value=!0,t.value.editingUser=e)}),r("addedMessage",e=>{e.i in t.value.uncollectedMessages||(t.value.uncollectedMessages[e.i]=[]),t.value.uncollectedMessages[e.i].push(e.id)}),r("addedMessage",e=>$(e)),setInterval(()=>{K()},1e3),setInterval(()=>{b.value=window.innerWidth},1);const b=(0,a.KR)(0);return(e,l)=>((0,u.uX)(),(0,u.CE)("div",ge,[(0,u.bF)(N,{"app-state":t.value,ref:"canvas"},null,8,["app-state"]),(0,u.bF)((0,a.R1)(le.A),{class:"user-editor-container",show:s.value,"onUpdate:show":l[2]||(l[2]=e=>s.value=e),width:b.value>500?500:b.value},{default:(0,u.k6)(()=>[(0,u.bF)((0,a.R1)(re.A),{"native-scrollbar":!1},{header:(0,u.k6)(()=>[(0,u.bF)((0,a.R1)(ie.A),{subtitle:"用户分析",onBack:l[0]||(l[0]=e=>{t.value.editingUser=-1,s.value=!1})}),(0,u.Lk)("h1",null,"#"+(0,o.v_)((0,a.R1)(C)(t.value.editingUser)),1)]),default:(0,u.k6)(()=>[(0,u.bF)((0,a.R1)(ce.A),{class:"user-editor",type:"segment",animated:""},{default:(0,u.k6)(()=>[(0,u.bF)((0,a.R1)(de.A),{name:"new",tab:"最新发言"},{default:(0,u.k6)(()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(t.value.uncollectedMessages[t.value.editingUser],e=>((0,u.uX)(),(0,u.Wv)(se,{msg:(0,a.R1)(c).messages[e],key:e},{action:(0,u.k6)(()=>[(0,u.bF)((0,a.R1)(ve.A),{justify:"space-between"},{default:(0,u.k6)(()=>[(0,u.bF)((0,a.R1)(fe.Ay),{onClick:t=>g((0,a.R1)(c).messages[e])},{default:(0,u.k6)(()=>[...l[5]||(l[5]=[(0,u.eW)("收集",-1)])]),_:1},8,["onClick"]),(0,u.bF)((0,a.R1)(fe.Ay),{onClick:t=>p((0,a.R1)(c).messages[e])},{default:(0,u.k6)(()=>[...l[6]||(l[6]=[(0,u.eW)("忽略",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["msg"]))),128))]),_:1}),(0,u.bF)((0,a.R1)(de.A),{name:"history",tab:"历史发言"},{default:(0,u.k6)(()=>[(0,u.bF)(oe,{source:i(t.value.editingUser),select:!1},null,8,["source"])]),_:1}),(0,u.bF)((0,a.R1)(de.A),{name:"push-list",tab:"本次推送"},{default:(0,u.k6)(()=>[(0,u.bF)(oe,{source:v(t.value.editingUser),select:!0,modelValue:t.value.readyToPushMessages[t.value.editingUser],"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.readyToPushMessages[t.value.editingUser]=e)},null,8,["source","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show","width"]),(0,u.Lk)("div",he,[(0,u.bF)((0,a.R1)(fe.Ay),{round:"",type:"primary",size:"large",onClick:l[3]||(l[3]=e=>n.value=!0)},{default:(0,u.k6)(()=>[...l[7]||(l[7]=[(0,u.eW)("已收集消息",-1)])]),_:1}),(0,u.bF)((0,a.R1)(fe.Ay),{round:"",type:"primary",size:"large",onClick:y},{default:(0,u.k6)(()=>[...l[8]||(l[8]=[(0,u.eW)("结束回合",-1)])]),_:1})]),(0,u.bF)((0,a.R1)(pe.A),{show:n.value,"onUpdate:show":l[4]||(l[4]=e=>n.value=e)},{default:(0,u.k6)(()=>[(0,u.bF)((0,a.R1)(q.Ay),{style:{width:"600px"},title:"已收集消息"},{default:(0,u.k6)(()=>[(0,u.bF)(oe,{source:t.value.collectedMessages.map(e=>(0,a.R1)(c).messages[e]),select:!1},null,8,["source"])]),_:1})]),_:1},8,["show"])]))}});const ye=me;var be=ye;(0,n.Ef)(be).mount("#app")}},t={};function s(n){var u=t[n];if(void 0!==u)return u.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,n,u,a){if(!n){var o=1/0;for(c=0;c<e.length;c++){n=e[c][0],u=e[c][1],a=e[c][2];for(var l=!0,r=0;r<n.length;r++)(!1&a||o>=a)&&Object.keys(s.O).every(function(e){return s.O[e](n[r])})?n.splice(r--,1):(l=!1,a<o&&(o=a));if(l){e.splice(c--,1);var i=u();void 0!==i&&(t=i)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,u,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var u,a,o=n[0],l=n[1],r=n[2],i=0;if(o.some(function(t){return 0!==e[t]})){for(u in l)s.o(l,u)&&(s.m[u]=l[u]);if(r)var c=r(s)}for(t&&t(n);i<o.length;i++)a=o[i],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(c)},n=self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[504],function(){return s(9542)});n=s.O(n)})();
//# sourceMappingURL=app.2472d20a.js.map